<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Realistic Valentine Drum</title>
    <style>
        :root {
            --pink: #ff8fa3;
            --gold: #d4af37;
            --silver: #c0c0c0;
            --wood: #5d4037;
        }

        body {
            margin: 0; background: radial-gradient(circle, #333, #000);
            color: white; font-family: sans-serif; overflow: hidden;
            display: flex; flex-direction: column; height: 100vh; touch-action: none;
        }

        /* „Ç≤„Éº„É†ÁîªÈù¢Ôºà„Éé„Éº„ÉÑ„ÅåÂ••„Åã„ÇâÊù•„ÇãÈ¢®Ôºâ */
        #game-view {
            flex: 1; position: relative; perspective: 500px;
            overflow: hidden; border-bottom: 4px solid var(--pink);
        }

        .note {
            position: absolute; width: 60px; height: 30px;
            background: var(--pink); border-radius: 50%;
            box-shadow: 0 0 15px var(--pink);
        }

        /* Ë¶ã‰∏ã„Çç„ÅóË¶ñÁÇπ„ÅÆ„Éâ„É©„É†„Çª„ÉÉ„Éà */
        .drum-kit {
            height: 300px; position: relative; background: #222;
            display: flex; justify-content: center; align-items: center;
        }

        .drum {
            position: absolute; border-radius: 50%; border: 8px solid var(--silver);
            background: radial-gradient(circle, #fff 60%, #eee 100%);
            box-shadow: 0 10px 0 #999, inset 0 0 20px rgba(0,0,0,0.2);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.05s;
        }
        .drum:active { transform: scale(0.95) translateY(5px); box-shadow: 0 2px 0 #999; }
        .drum::after { content: "‚ù§"; color: #ddd; font-size: 20px; }

        /* „Éâ„É©„É†ÈÖçÁΩÆÔºàË¶ã‰∏ã„Çç„ÅóÔºâ */
        .snare { width: 120px; height: 120px; bottom: 20px; left: 15%; } /* „Çπ„Éç„Ç¢ */
        .hihat { width: 100px; height: 100px; bottom: 80px; left: 5%; background: var(--gold); border-color: #b8860b; }
        .tom { width: 110px; height: 110px; top: 20px; left: 35%; }
        .floor-tom { width: 140px; height: 140px; bottom: 20px; right: 10%; }
        .bass-drum { width: 160px; height: 160px; bottom: 40px; left: 50%; transform: translateX(-50%); border-color: var(--wood); }

        #score { position: absolute; top: 20px; left: 20px; font-size: 24px; color: var(--pink); font-weight: bold; }
        .btn-start {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 20px 40px; font-size: 24px; border-radius: 50px;
            background: var(--pink); border: none; color: white; cursor: pointer; z-index: 100;
        }
    </style>
</head>
<body>

<div id="game-view">
    <div id="score">SCORE: 0</div>
    <button class="btn-start" id="startBtn" onclick="startShow()">LIVE START! üç´</button>
</div>

<div class="drum-kit">
    <div class="drum hihat" onmousedown="hit(0)" data-lane="0"></div>
    <div class="drum snare" onmousedown="hit(1)" data-lane="1"></div>
    <div class="drum bass-drum" onmousedown="hit(2)" data-lane="2"></div>
    <div class="drum tom" onmousedown="hit(3)" data-lane="3"></div>
    <div class="drum floor-tom" onmousedown="hit(4)" data-lane="4"></div>
</div>

<script>
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    let score = 0;
    const notes = [];
    const lanes = [5, 15, 50, 35, 80]; // „Éé„Éº„ÉÑ„ÅåÈôç„ÇãÊ®™‰ΩçÁΩÆ(%)

    // --- Èü≥Ê∫êÁîüÊàê ---
    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);

        const now = audioCtx.currentTime;
        if (type === 2) { // Bass
            osc.frequency.setValueAtTime(120, now);
            osc.frequency.exponentialRampToValueAtTime(0.01, now + 0.4);
            gain.gain.setValueAtTime(1, now);
        } else if (type === 1) { // Snare
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(220, now);
            gain.gain.setValueAtTime(0.4, now);
        } else if (type === 0) { // Hi-hat
            osc.type = 'sine';
            osc.frequency.setValueAtTime(10000, now);
            gain.gain.setValueAtTime(0.1, now);
        } else { // Tom
            osc.frequency.setValueAtTime(150, now);
            gain.gain.setValueAtTime(0.5, now);
        }
        osc.start(); osc.stop(now + 0.2);
    }

    // --- Èü≥Ê•ΩËá™ÂãïÊºîÂ•è (BPM 120„ÅÆ„Éê„É¨„É≥„Çø„Ç§„É≥È¢®„É°„É≠„Éá„Ç£) ---
    function playBackgroundMusic() {
        const synthGain = audioCtx.createGain();
        synthGain.connect(audioCtx.destination);
        synthGain.gain.value = 0.1;

        const melody = [
            {f: 349, d: 0.4}, {f: 392, d: 0.4}, {f: 440, d: 0.4}, {f: 523, d: 0.8}, // „Éê„É¨„É≥„Çø„Ç§„É≥„Éá„Éº
            {f: 440, d: 0.4}, {f: 392, d: 0.4}, {f: 349, d: 0.8}  // „Ç≠„ÉÉ„Çπ
        ];

        let time = audioCtx.currentTime;
        setInterval(() => {
            melody.forEach(n => {
                const osc = audioCtx.createOscillator();
                osc.type = 'square';
                osc.frequency.setValueAtTime(n.f, time);
                osc.connect(synthGain);
                osc.start(time);
                osc.stop(time + n.d - 0.05);
                time += n.d;
            });
        }, 4000);
    }

    // --- „Ç≤„Éº„É†„É≠„Ç∏„ÉÉ„ÇØ ---
    function spawnNote(lane) {
        const noteEl = document.createElement('div');
        noteEl.className = 'note';
        noteEl.style.left = lanes[lane] + '%';
        noteEl.style.top = '0px';
        document.getElementById('game-view').appendChild(noteEl);
        notes.push({ el: noteEl, lane: lane, top: 0 });
    }

    function hit(lane) {
        playSound(lane);
        for (let i = 0; i < notes.length; i++) {
            if (notes[i].lane === lane && notes[i].top > window.innerHeight * 0.7) {
                notes[i].el.remove();
                notes.splice(i, 1);
                score += 100;
                document.getElementById('score').innerText = `SCORE: ${score}`;
                break;
            }
        }
    }

    function update() {
        for (let i = notes.length - 1; i >= 0; i--) {
            notes[i].top += 5;
            notes[i].el.style.top = notes[i].top + 'px';
            if (notes[i].top > window.innerHeight) {
                notes[i].el.remove();
                notes.splice(i, 1);
            }
        }
        requestAnimationFrame(update);
    }

    function startShow() {
        document.getElementById('startBtn').style.display = 'none';
        playBackgroundMusic();
        update();
        // Ë≠úÈù¢ÁîüÊàê
        setInterval(() => {
            spawnNote(Math.floor(Math.random() * 5));
        }, 600);
    }
</script>
</body>
</html>
