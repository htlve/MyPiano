<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Valentine's Day Kiss Drum</title>
    <style>
        :root {
            --love-pink: #ff8fa3;
            --choco-brown: #5d4037;
            --heart-red: #ff4b5c;
            --ribbon-gold: #ffd700;
        }

        body {
            margin: 0; background: #fff0f3; color: var(--choco-brown);
            font-family: 'Hiragino Maru Gothic ProN', sans-serif; overflow: hidden;
            display: flex; flex-direction: column; height: 100vh;
            touch-action: none;
        }

        /* „ÉÅ„Éß„Ç≥„Å®„Éè„Éº„Éà„ÅÆ„Çπ„ÉÜ„Éº„Ç∏ */
        #stage {
            flex: 1; position: relative;
            background-color: #fff0f3;
            background-image: radial-gradient(var(--love-pink) 1px, transparent 1px);
            background-size: 20px 20px;
            overflow: hidden;
        }

        #score-board {
            position: absolute; top: 20px; width: 100%; text-align: center;
            font-size: 28px; font-weight: bold; color: var(--heart-red);
            text-shadow: 2px 2px white; z-index: 10;
        }

        /* „Éè„Éº„Éà„ÅÆ„Çø„Éº„Ç≤„ÉÉ„Éà */
        .lanes {
            display: flex; justify-content: space-around;
            position: absolute; bottom: 100px; width: 100%;
        }

        .target-heart {
            width: 80px; height: 80px; position: relative;
            display: flex; align-items: center; justify-content: center;
        }

        .target-heart::before {
            content: "‚ù§"; font-size: 80px; color: rgba(255, 143, 163, 0.3);
            position: absolute;
        }

        .target-heart.hit::before {
            color: var(--heart-red);
            animation: heart-pop 0.2s;
        }

        /* Èôç„Å£„Å¶„Åè„Çã„Éé„Éº„ÉÑÔºà„ÉÅ„Éß„Ç≥„ÉÅ„ÉÉ„ÉóÈ¢®Ôºâ */
        .note {
            position: absolute; width: 50px; height: 50px;
            background: var(--choco-brown); border-radius: 50%;
            border: 4px solid var(--ribbon-gold);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* Êìç‰Ωú„Éë„ÉÉ„Éâ */
        .drum-pads {
            display: flex; height: 140px; background: var(--love-pink);
            padding: 15px; gap: 15px; border-radius: 30px 30px 0 0;
        }

        .pad {
            flex: 1; border-radius: 20px; background: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 30px; border-bottom: 6px solid #ffccd5; cursor: pointer;
        }

        .pad:active { transform: translateY(4px); border-bottom: none; }

        @keyframes heart-pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.4); }
            100% { transform: scale(1); }
        }

        .start-btn {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 15px 40px; font-size: 20px; border-radius: 50px;
            background: var(--heart-red); color: white; border: none;
            box-shadow: 0 5px 15px rgba(255, 75, 92, 0.4); font-weight: bold;
        }
    </style>
</head>
<body>

<div id="stage">
    <div id="score-board">üíù Kiss Combo: <span id="combo">0</span></div>
    <div class="lanes">
        <div class="target-heart" id="target-0"></div>
        <div class="target-heart" id="target-1"></div>
        <div class="target-heart" id="target-2"></div>
    </div>
    <button class="start-btn" id="startBtn" onclick="playValentine()">START üíã</button>
</div>

<div class="drum-pads">
    <div class="pad" onmousedown="hit(0)" ontouchstart="hit(0)">üç´</div>
    <div class="pad" onmousedown="hit(1)" ontouchstart="hit(1)">üéÅ</div>
    <div class="pad" onmousedown="hit(2)" ontouchstart="hit(2)">üéÄ</div>
</div>

<script>
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    let combo = 0;
    const notes = [];
    const laneX = [0.16, 0.5, 0.83];

    function playDrumSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);

        // „Å°„Çá„Å£„Å®Áîò„ÅÑ„Äå„Éù„Ç≥„ÉÉ„Äç„Å®„ÅÑ„ÅÜÈü≥Ëâ≤
        osc.type = 'sine';
        const freqs = [180, 260, 320];
        osc.frequency.setValueAtTime(freqs[type], audioCtx.currentTime);
        gain.gain.setValueAtTime(0.4, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
        osc.start(); osc.stop(audioCtx.currentTime + 0.2);
    }

    function spawnNote(lane) {
        const noteEl = document.createElement('div');
        noteEl.className = 'note';
        noteEl.innerHTML = '‚ù§Ô∏è';
        noteEl.style.left = `calc(${laneX[lane] * 100}% - 25px)`;
        noteEl.style.top = '-60px';
        document.getElementById('stage').appendChild(noteEl);
        notes.push({ el: noteEl, lane: lane, top: -60 });
    }

    function update() {
        for (let i = notes.length - 1; i >= 0; i--) {
            const n = notes[i];
            n.top += 6; // Â∞ë„ÅóÈÄü„ÇÅ
            n.el.style.top = n.top + 'px';
            if (n.top > window.innerHeight) {
                n.el.remove();
                notes.splice(i, 1);
                combo = 0; updateCombo();
            }
        }
        requestAnimationFrame(update);
    }

    function hit(lane) {
        playDrumSound(lane);
        const target = document.getElementById(`target-${lane}`);
        target.classList.add('hit');
        setTimeout(() => target.classList.remove('hit'), 150);

        const targetY = target.getBoundingClientRect().top;
        for (let i = 0; i < notes.length; i++) {
            const n = notes[i];
            if (n.lane === lane && Math.abs(n.top - targetY) < 60) {
                n.el.innerHTML = 'üíã';
                n.el.style.background = 'transparent';
                n.el.style.border = 'none';
                setTimeout(() => n.el.remove(), 100);
                notes.splice(i, 1);
                combo++; updateCombo();
                break;
            }
        }
    }

    function updateCombo() {
        document.getElementById('combo').innerText = combo;
    }

    function playValentine() {
        document.getElementById('startBtn').style.display = 'none';
        // „Äå„Éê„Éª„É¨„Éª„É≥„Éª„Çø„Éª„Ç§„Éª„É≥„Éª„Éá„Éª„Éº„Éª„Ç≠„ÉÉ„ÇπÔºÅ„Äç„ÅÆ„É™„Ç∫„É†
        const rhythm = [
            {l:0, d:0}, {l:1, d:400}, {l:2, d:800}, {l:1, d:1200}, // „Éê„Éª„É¨„Éª„É≥„Éª„Çø
            {l:0, d:1600}, {l:1, d:2000}, {l:2, d:2400}, {l:2, d:2700}, // „Ç§„Éª„É≥„Éª„Éá„Éª„Éº
            {l:1, d:3200}, {l:1, d:3400} // „Ç≠„ÉÉ„Éª„ÇπÔºÅ
        ];
        
        let loop = 0;
        const playLoop = () => {
            rhythm.forEach(r => {
                setTimeout(() => spawnNote(r.l), r.d);
            });
            loop++;
            if(loop < 5) setTimeout(playLoop, 4000);
        };
        playLoop();
    }

    update();
</script>
</body>
</html>
